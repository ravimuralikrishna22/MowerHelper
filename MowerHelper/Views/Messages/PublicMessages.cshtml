@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
@*    <meta name="viewport" content="width=device-width" />*@
    <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
   <title>Mower Helper-Find an Mower Helper</title>
@*        <link href="~/Content/style.css" rel="stylesheet" type="text/css" media="all" />
    <script src="~/SCRIPTS/scriptCognetwork.js" type="text/javascript"></script>
    <link href="~/Content/themes/base/jquery.ui.all.css" rel="stylesheet" type="text/css" />
        <script src="~/Scripts/jquery-1.7.1.js" type="text/javascript"></script>
 <script src="~/Scripts/jquery-ui-1.8.11.js" type="text/javascript"></script>
        <link href="~/Content/flytooltip.css" rel="stylesheet" type="text/css" />
   <script  src="~/Scripts/flytooltip.js" type="text/javascript"></script>*@
              @Styles.Render("~/Content/themes/base/TherpistStyles")
         @Scripts.Render("~/ThScripts/ElectricianHelpscripts")
     <script type="text/javascript">
         function ondescriptionover(obj) {
             document.getElementById(obj).style.position = 'absolute';
             document.getElementById(obj).style.display = '';
             return false;
         }
         function ondescriptionout(obj) {
             document.getElementById(obj).style.display = 'none';
             return false;
         }
    </script>

            <script type="text/javascript">
                $(document).ready(function () {
                    var Type = $('#hdntype').val();
                    if (Type != '') {
                        $('#ddlListingMsgsType').val(Type);
                    }
                    else {
                        $('#ddlListingMsgsType').val("N");

                    }
                    var psize = $('#hdnpagesize').val();
                    if (psize != '') {

                        $('#ddlrecords').val(psize);
                    }
                    else {
                        $('#ddlrecords').val("10");

                    }


                    var fromdate = $('#hdnFromdate').val();
                    if (fromdate != '') {
                        $('#txt_FromDate').val(fromdate);
                        document.getElementById('tddaterange').style.display = '';
                    }
                    else {
                        $('#txt_FromDate').val("");
                        document.getElementById('tddaterange').style.display = 'none';

                    }

                    var todate = $('#hdnTodate').val();
                    if (todate != '') {
                        $('#txt_ToDate').val(todate);
                        document.getElementById('tddaterange').style.display = '';
                    }
                    else {
                        $('#txt_ToDate').val("");
                        document.getElementById('tddaterange').style.display = 'none';

                    }

                    var drange = $('#hdndaterange').val();
                    if (drange != '') {
                        $('#dt_filter').val(drange);

                    }
                    else {
                        $('#dt_filter').val("30");


                    }

                });
    </script>
        <style type="text/css">
        .ui-datepicker-trigger
        {
            margin-left: 5px;
            vertical-align: middle;
        }
    </style>
    <script type="text/javascript">

        $(document).ready(function () {
            var frm = $("#formname");
            $('#dt_filter').change(function () {
                if (document.getElementById('dt_filter').value == 'Custom') {
                    document.getElementById('tddaterange').style.display = '';
                    $('#txt_FromDate').val("");
                    $('#txt_ToDate').val("");
                }
                else {
                    document.getElementById('tddaterange').style.display = 'none';
                    $('#txt_FromDate').val("");
                    $('#txt_ToDate').val("");
                }
                return false;
            });
        });
</script>
<script type="text/javascript">

    $(function () {
        $("#txt_FromDate,#txtEndDateforDaily,#txtEndDateforWeek").datepicker({
            showOn: "button",
            buttonImage: "../Images/calender.gif",
            buttonImageOnly: true
        });
    });


    $(function () {
        $("#txt_ToDate,#txtEndDateforDaily,#txtEndDateforWeek").datepicker({
            showOn: "button",
            buttonImage: "../Images/calender.gif",
            buttonImageOnly: true
        });
    });
    </script>
    <script language="javascript" type="text/javascript">
        function ValidSearch() {

            if (document.getElementById('dt_filter').selectedIndex == 0) {
                alert("Select date");
                return false;
            }
            if (document.getElementById('dt_filter').value == 'Custom') {

                if (document.getElementById('txt_FromDate').value != '' && document.getElementById('txt_FromDate').value != "mm/dd/yyyy") {
                    if (CheckValidDate(document.getElementById('txt_FromDate')) == 0) {
                        return false;
                    }
                }
                if (document.getElementById('txt_ToDate').value != '' && document.getElementById('txt_ToDate').value != "mm/dd/yyyy") {
                    if (CheckValidDate(document.getElementById('txt_ToDate')) == 0) {
                        return false;
                    }
                }
                var CDate = new Date()
                var CFormatDate = CDate.getUTCMonth() + 1 + "/" + CDate.getDate() + "/" + CDate.getFullYear();
                var FromDate = document.getElementById('txt_FromDate').value;
                if (document.getElementById('txt_FromDate').value == '' || document.getElementById('txt_FromDate').value == "mm/dd/yyyy") {
                    alert('Select from date');
                    document.getElementById('txt_FromDate').focus();
                    return false;
                }
                if (document.getElementById('txt_ToDate').value == '' || document.getElementById('txt_ToDate').value == "mm/dd/yyyy") {
                    alert('Select to date');
                    document.getElementById('txt_ToDate').focus();
                    return false;
                }
                var St = document.getElementById('txt_FromDate').value;
                St = new Date(St);
                var En = document.getElementById('txt_ToDate').value
                En = new Date(En);
                if (St > En) {
                    alert("From date should not be greater than to date")
                    return false;
                }

            }
        }
						
    </script>
   @* <style type="text/css">
        .dvLoading .ui-dialog-titlebar{display:none;}       
                  tr.gridHead th:nth-child(1) { width: 170px; }
          tr.gridHead th:nth-child(2) { width: 270px; }
          tr.gridHead th:nth-child(3) { width: 270px; }
          tr.gridHead th:nth-child(4) { width: 270px; }
          tr.gridHead th:nth-child(5) { width: 80px; }
          tr.gridHead th:nth-child(6) { width: 120px; }
          tr.gridRow td:nth-child(2) { width: 300px;text-align:left; }
          tr.gridAltRow td:nth-child(2) { width: 300px;text-align:left; }
                    tr.gridRow td:nth-child(3) { width: 300px;text-align:left; }
          tr.gridAltRow td:nth-child(3) { width: 300px;text-align:left; }
                    tr.gridRow td:nth-child(4) { width: 300px;text-align:left; }
          tr.gridAltRow td:nth-child(4) { width: 300px;text-align:left; }
    </style>*@
</head>
<body>
    @using (Html.BeginForm("PublicMessages", "Messages", FormMethod.Get, null))
    {
    <div>
        @{Html.RenderAction("Topsection", "Tools");}
    </div>
    <div>
       @{Html.RenderAction("Msg_Main", "Messages", new { @Tabid = "3" });}
    </div>
    <div id="main-content">
        <table width="100%" cellpadding="0" cellspacing="0" border="0">
            <tr class="background_color">
                <td align="left" valign="top" width="100%">
                    <table width="100%" cellpadding="0" cellspacing="0" border="0">
                        <tr id="trtabs">
                            <td width="100%" class="navigation">
                                <div class="admin-tab">
                                @{int FromThhelpCount = Convert.ToInt32(ViewBag.FromThhelpCount);}
                                    <a class="inadmin-link" href="MessageFromHelp" id="afromtherapisthelp"><span>From Mower Helper&nbsp;&nbsp;(@FromThhelpCount)</span>
                                    </a>
                                </div>
                                <div class="admin-tab">
                                  @{int FromPublicCount = Convert.ToInt32(ViewBag.FromPublicCount);}
                                    <a class="admin-link" id="aFrompubliclisting" href="PublicMessages"><span>From public profile page&nbsp;&nbsp;(@FromPublicCount)</span>
                                    </a>
                                </div>
                                                                                                                                                                          @if (ViewBag.Roleid == "4" && ViewBag.Showschedule == "Y")
                                                                                                                                               {
                                          <div class="admin-tab">
                                                                @{int vusercount = Convert.ToInt32(ViewBag.aptreqcount);}
                                    <a class="inadmin-link" id="aschedulemessage" href="ScheduleMessages"><span>Appointment Requests&nbsp;&nbsp;(@vusercount)</span>
                                    </a>
                                </div>
                                            }
                                                                <div class="admin-tab">
                                                                @{int Sentcount = Convert.ToInt32(ViewBag.Sentcount);}
                                    <a class="inadmin-link" id="aSentMessages" href="SentMessages"><span>Sent messages&nbsp;&nbsp;(@Sentcount)</span>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        <tr class="background_color">
                            <td id="tdtabs" class="tab-background" width="100%">
                            
                                <div class="content-box">
                                    <div class="content-box-header">
                                        <table width="100%" cellpadding="0" cellspacing="0" style="float: left;">
                                            <tr>
                                                <td width="10%" align="left">
                                                    <h3>
                                                        Public messages</h3>
                                                </td>
                                                <td width="10%" align="right">
                                                    <strong>Date &nbsp;:&nbsp; </strong>
                                                </td>
                                                <td width="30%" align="left">
                                                    <table width="100%" align="left">
                                                        <tr>
                                                            <td width="30%" align="left">

                                                                @Html.DropDownList("dt_filter", new List<SelectListItem>

                                                              {
                                                               new SelectListItem{ Text="--Select dates--", Value = "0" },
                                                               new SelectListItem{ Text="Today", Value = "Today" },
                                                               new SelectListItem{ Text="Last 7 days", Value = "7" },
                                                               new SelectListItem{ Text="Last 30 days", Value = "30" }, 
                                                               new SelectListItem{ Text="Custom", Value = "Custom" }, 
                                                              },
                                                               new { style = "font-family:arial;font-size:13px;height:20px;width:120px;" })
                                                            </td>
                                                            <td align="left" width="60%" id="tddaterange" runat="server" style="display: none">
                                                                <strong>From : </strong>&nbsp;&nbsp;&nbsp;  
                                                              <input type="text" name="txt_FromDate" id="txt_FromDate" class="textfield" maxlength="10" style="width: 75px;" />
                                                                &nbsp;&nbsp; <strong>To : </strong>&nbsp;&nbsp;&nbsp; 
                                                             <input type="text" name="txt_ToDate" id="txt_ToDate" class="textfield" maxlength="10" style="width: 75px;" />
                                                            </td>
                                                            <td width="10%" align="right">
                                                                <input type="submit" name="btnSearch1" value="Search" id="ibtnSearch1" onclick="return ValidSearch();" class="button" />
                                                            </td>
                                                        </tr>
                                                    </table>

                                                </td>
                                                <td width="20%" align="center">
                                                    <ul style="list-style: none!important; padding-right: 5px; padding-top: 5px;" class="content-box-tabs">
                                                        <li><strong>Filter by :&nbsp;</strong>
                                                            @Html.DropDownList("ddlListingMsgsType", new List<SelectListItem>

                                                              {
                                                               new SelectListItem{ Text="New", Value = "A" },
                                                               new SelectListItem{ Text="Viewed", Value = "V" },
                                                               new SelectListItem{ Text="Archived", Value = "I" },
                                                               new SelectListItem{ Text="All", Value = "All" }, 
                                                               new SelectListItem{ Text="New/Viewed", Value = "N" }, 
                                                              },
                                                             new { onchange = "this.form.submit();", style = "font-family:arial;font-size:13px;height:20px;width:120px;" })
                                                        </li>
                                                    </ul>
                                                </td>
                                                @if (Convert.ToInt32(ViewBag.totrec) > 0)
                                                {
                                                <td width="20%" align="center">
                                                    <ul style="list-style: none!important; padding-right: 5px; padding-top: 5px;" class="content-box-tabs">
                                                        <li><strong>Rows per page :&nbsp;</strong>
                                                         @{Html.RenderAction("Rowsperpage", "Profiles", new { @id = "1" });}
                                                           @* @Html.DropDownList("ddlRecords", new List<SelectListItem>

                                                              {
                                                               new SelectListItem{ Text="5", Value = "5" },
                                                               new SelectListItem{ Text="10", Value = "10" },
                                                               new SelectListItem{ Text="15", Value = "15" },
                                                               new SelectListItem{ Text="20", Value = "20" }, 
                                                               new SelectListItem{ Text="25", Value = "25" }, 
                                                               new SelectListItem{ Text="30", Value = "30" }, 
                                                               new SelectListItem{ Text="35", Value = "35" },
                                                               new SelectListItem{ Text="40", Value = "40" },
                                                               new SelectListItem{ Text="45", Value = "45" },
                                                               new SelectListItem{ Text="50", Value = "50" }, 
                                                              },
                                                             new { onchange = "this.form.submit();", style = "font-family:arial;font-size:13px;height:20px;width:48px;" })*@
                                                        </li>
                                                    </ul>
                                                </td>
                                                }
                                            </tr>
                                        </table>
                                        <div class="clear">
                                        </div>
                                    </div>
                                    <div class="content-box-content">
                                        @{string heading1;
                                          if (Request["sort"] == "CreatedOn" && Request["sortdir"] == "ASC")
                                          {
                                              heading1 = "Date time ▲";
                                          }
                                          else if (Request["sort"] == "CreatedOn" && Request["sortdir"] == "DESC")
                                          {
                                              heading1 = "Date time ▼";
                                          }
                                          else
                                          {
                                              heading1 = "Date time .";
                                          }
                                        }
                                        @{string MSgpagesize = (ViewBag.Publiclistingpagesize == null ? "10" : ViewBag.Publiclistingpagesize);
                                          WebGrid Msggrid = new WebGrid(rowsPerPage: Convert.ToInt32(MSgpagesize));}
                                        @{WebGrid grid = Msggrid.Bind(rowCount: Convert.ToInt32(ViewBag.totrec), source: Model, autoSortAndPage: false);
                                          if (grid.TotalRowCount != 0)
                                          {
                                              int count = 0;
                                              string pager = grid.Pager().ToString();
                                              string pageno = (Request["page"] == null ? "1" : Request["page"]);
                                              string newpager = System.Text.RegularExpressions.Regex.Replace(pager, "(\\d+) ", "<span class='selected'>" + pageno + "</span>");
                                              if (ViewBag.Type != "I")
                                              {
                                                  string gridhtml = grid.GetHtml(tableStyle: "gridTable", headerStyle: "gridHead", rowStyle: "gridRow", alternatingRowStyle: "gridAltRow",
                                                  columns: grid.Columns(
                                                  grid.Column("CreatedOn", heading1),
                                                  grid.Column("Sender_Name", "Sender name"),
                                                   grid.Column("Sender_Email", "Sender email"),
                                                      //grid.Column("Message", "Message"),
                                                    grid.Column("", "Subject", canSort: false,
                                  format:@<text>@Html.ActionLink((string)(item.Subject), "publicMessageview", new { Msg_id = (int)item.Provider_PublicMessages_ID }, new { @class = "TopicLink", @style = ((string)(item.Status_Ind) == "A" ? "font-weight:bold;color:#0066CC;cursor:pointer;" : "font-weight:;color:#0066CC;cursor:pointer;") })</text>),
                                                                           grid.Column("", "Message", canSort: false,
                                                  format:@<text>
                                                         @{string description = (string)item.contactmessage;
                                                           if (description.Length > 100)
                                                           {
                                                               count = count + 1;
                                                               description = description.Substring(0, 100);
                                                            <span>@description</span><a id="amore" onclick="return false;" onmouseover="return ondescriptionover('tbldesc @count');" onmouseout="return ondescriptionout('tbldesc @count');"  style="font-weight:bold;color:#0066CC;cursor:pointer;">...More</a>
                                                             <div id="tbldesc @count" style="width: 400px; height: 100px; display: none;"> 
                                                             <div class="content-box-header">
                                                             <h3> Message :</h3> </div>
                                                              <table cellspacing="1" class="border_style" cellpadding="4"
                                                             width="100%" align="center" border="0"> 
                                                             <tr class="white_color"> 
                                                             <td style="width:380px; text-align: justify; padding-bottom: 5px; padding-left: 5px; padding-right:
                                                             5px; padding-top: 5px;" align="left"> <span>@item.contactmessage</span> </td> </tr>
                                                             </table> </div>
                                                           }
                                                           else
                                                           {
                                                       <span>@item.contactmessage</span>
                                                           }
                                                           }
                                                
                                                </text>),
                                                                                       grid.Column("", "Change status to", canSort: false,
                                                      format:@<text>@Html.ActionLink(((string)(item.Status_Ind) == "A" ? "Viewed" : "Archive"), "changestatustonewpatients", new { Msg_id = (int)item.Provider_PublicMessages_ID, status_ind = (string)item.Status_Ind },
                                             new { @style = ((string)(item.Status_Ind) == "A" ? "font-weight:bold;color:#0066CC;cursor:pointer;" : "font-weight:;color:#0066CC;cursor:pointer;"), @class = "confirmDialog", @title = "Click here to change status" })</text>)
                                                      //grid.Column("Status_Ind", "Status")                                                                                                                                                                                                

                                                     )).ToString();
                                                  gridhtml = System.Text.RegularExpressions.Regex.Replace(gridhtml, "<tfoot>([^<]*|<[^/]*|</[^t]*)*</tfoot>", "");
                                            @(new HtmlString(gridhtml))
                                              }
                                              else
                                              {
                                                  string gridhtml = grid.GetHtml(tableStyle: "gridTable", headerStyle: "gridHead", rowStyle: "gridRow", alternatingRowStyle: "gridAltRow",
columns: grid.Columns(
grid.Column("CreatedOn", heading1),
grid.Column("Sender_Name", "Sender name"),
 grid.Column("Sender_Email", "Sender email"),
                                      grid.Column("", "Subject", canSort: false,
                                  format:@<text>@Html.ActionLink((string)(item.Subject), "publicMessageview", new { Msg_id = (int)item.Provider_PublicMessages_ID }, new { @class = "TopicLink", @style = ((string)(item.Status_Ind) == "A" ? "font-weight:bold;color:#0066CC;cursor:pointer;" : "font-weight:;color:#0066CC;cursor:pointer;") })</text>),
                                                      //grid.Column("Message", "Message"),
  grid.Column("", "Message", canSort: false,
                                                  format:@<text>
                                                         @{string description = (string)item.contactmessage;
                                                           if (description.Length > 100)
                                                           {
                                                               count = count + 1;
                                                               description = description.Substring(0, 100);
                                                            <span>@description</span><a id="amore" onclick="return false;" onmouseover="return ondescriptionover('tbldesc @count');" onmouseout="return ondescriptionout('tbldesc @count');"  style="font-weight:bold;color:#0066CC;cursor:pointer;">...More</a>
                                                             <div id="tbldesc @count" style="width: 400px; height: 100px; display: none;"> 
                                                             <div class="content-box-header">
                                                             <h3> Message :</h3> </div>
                                                              <table cellspacing="1" class="border_style" cellpadding="4"
                                                             width="100%" align="center" border="0"> 
                                                             <tr class="white_color"> 
                                                             <td style="width:380px; text-align: justify; padding-bottom: 5px; padding-left: 5px; padding-right:
                                                             5px; padding-top: 5px;" align="left"> <span>@item.contactmessage</span> </td> </tr>
                                                             </table> </div>
                                                           }
                                                           else
                                                           {
                                                       <span>@item.contactmessage</span>
                                                           }
                                                           }
                                                
                                                </text>)

   )).ToString();
                                                  gridhtml = System.Text.RegularExpressions.Regex.Replace(gridhtml, "<tfoot>([^<]*|<[^/]*|</[^t]*)*</tfoot>", "");
                                            @(new HtmlString(gridhtml))
                                              }
                                            <br />
                                            <div class="gridFooter" style="padding-left: 500px;">@(new HtmlString(newpager))</div>  
                                            <br />



                                          }
                                          else
                                          {
                                            <table id="tblMsg" cellspacing="0" cellpadding="0" width="100%" align="center" border="0">
                                                <tr id="trdsmerror" class="white_color">
                                                    <td align="center" height="25px" valign="middle" colspan="2">
                                                        <span id="lbl_NoRecordMsg" class="errormsg" style="font-size: 13px; font-weight: bold;">
                                                            No public messages found</span>
                                                    </td>
                                                </tr>
                                            </table>
                                          }
                                        }
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>
    <div id="dialog-confirm" title="Mower Helper" style="display: none;">
        <p>
            <span class="ui-icon ui-icon-alert" style="float: left; margin: 0 7px 20px 0;"></span>
            Do you want to archive the message?
        </p>
    </div>
    <div id="TopicDialog" title="Message details">
    </div>
        
<div id="dvLoading" style="display:none; text-align:center; vertical-align:middle">
     <img src="../Images/ajax-loader2.gif" alt="Processing"  />
    </div>
                <input id="hdntype" type="hidden" value="@ViewBag.Type"/>
            <input id="hdnpagesize" name="hdnpagesize" type="hidden" value="@ViewBag.Publiclistingpagesize"/>
        <input id="hdnFromdate" type="hidden" value="@ViewBag.Fromdate"/>
        <input id="hdnTodate" type="hidden" value="@ViewBag.Todate"/>
        <input id="hdndaterange" type="hidden" value="@ViewBag.Daterange"/>
                            <div>
        @{Html.RenderAction("Bottomsections", "Tools");}
    </div>
  
    <script type="text/javascript">
        $(".confirmDialog").live("click", function (e) {

            var url = $(this).attr('href');
            $("#dialog-confirm").dialog({
                autoOpen: false,
                height: 170,
                width: 350,
                show: { effect: 'drop', direction: "up" },
                modal: true,
                buttons: {
                    "Yes": function () {
                        $(this).dialog("close");
                        window.location = url;

                    },
                    "No": function () {
                        $(this).dialog("close");

                    }
                }
            });
            $("#dialog-confirm").dialog('open');
            return false;
        });
        var linkObj;
        $(function () {
            $('#TopicDialog').dialog({
                autoOpen: false,
                width: 600,
                resizable: false,
                modal: true

            });
            $(".TopicLink").click(function () {
                //change the title of the dialog
                linkObj = $(this);
                var dialogDiv = $('#TopicDialog');
                $('#dvLoading').dialog({ modal: true, dialogClass: 'dvLoading', draggable: false, resizable: false });
                var viewUrl = linkObj.attr('href');
                $.get(viewUrl, function (data) {
                    dialogDiv.html(data);
                    $('#dvLoading').dialog('close');
                    dialogDiv.dialog('open');
                });
                return false;
            });
        });
    </script>
    }
    <script type="text/javascript">
        $(document).ready(function () {
            var TopIndex = '@Session["TopIndex"]';
            $("#Menu0").removeClass();
            $("#Menu1").removeClass();
            $("#Menu2").removeClass();
            $("#Menu3").addClass("active");
            $("#Menu4").removeClass();
        });
    </script>
</body>
</html>

